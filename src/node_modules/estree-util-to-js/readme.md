# estree-util-to-js

[![Build](https://github.com/syntax-tree/estree-util-to-js/workflows/main/badge.svg)](https://github.com/syntax-tree/estree-util-to-js/actions) [![Coverage](https://img.shields.io/codecov/c/github/syntax-tree/estree-util-to-js.svg)](https://codecov.io/github/syntax-tree/estree-util-to-js) [![Downloads](https://img.shields.io/npm/dm/estree-util-to-js.svg)](https://www.npmjs.com/package/estree-util-to-js) [![Size](https://img.shields.io/bundlephobia/minzip/estree-util-to-js.svg)](https://bundlephobia.com/result?p=estree-util-to-js) [![Sponsors](https://opencollective.com/unified/sponsors/badge.svg)](https://opencollective.com/unified) [![Backers](https://opencollective.com/unified/backers/badge.svg)](https://opencollective.com/unified) [![Chat](https://img.shields.io/badge/chat-discussions-success.svg)](https://github.com/syntax-tree/unist/discussions)

[estree](https://github.com/estree/estree) (and [esast](https://github.com/syntax-tree/esast)) utility to serialize estrees as JavaScript.

## Contents

* [What is this?](./#what-is-this)
* [When should I use this?](./#when-should-i-use-this)
* [Install](./#install)
* [Use](./#use)
* [API](./#api)
  * [`toJs(tree[, options])`](./#tojstree-options)
  * [`jsx`](./#jsx)
  * [`Handler`](./#handler)
  * [`Handlers`](./#handlers)
  * [`Map`](./#map)
  * [`Options`](./#options)
  * [`Result`](./#result)
  * [`State`](./#state)
* [Examples](./#examples)
  * [Example: source maps](./#example-source-maps)
  * [Example: comments](./#example-comments)
  * [Example: JSX](./#example-jsx)
* [Types](./#types)
* [Compatibility](./#compatibility)
* [Contribute](./#contribute)
* [License](./#license)

## What is this?

This package is a utility that turns an estree syntax tree into a string of JavaScript.

## When should I use this?

You can use this utility when you want to get the serialized JavaScript that is represented by the syntax tree, either because you’re done with the syntax tree, or because you’re integrating with another tool that does not support syntax trees.

This utility is particularly useful when integrating with other unified tools, such as unist and vfile.

The utility [`esast-util-from-js`](https://github.com/syntax-tree/esast-util-from-js) does the inverse of this utility. It turns JS into esast.

## Install

This package is [ESM only](https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c). In Node.js (version 14.14+ and 16.0+), install with [npm](https://docs.npmjs.com/cli/install):

```sh
npm install estree-util-to-js
```

In Deno with [`esm.sh`](https://esm.sh):

```js
import {toJs} from 'https://esm.sh/estree-util-to-js@1'
```

In browsers with [`esm.sh`](https://esm.sh):

```html
<script type="module">
  import {toJs} from 'https://esm.sh/estree-util-to-js@1?bundle'
</script>
```

## Use

```js
import fs from 'node:fs/promises'
import {parse} from 'acorn'
import {toJs} from 'estree-util-to-js'

const file = String(await fs.readFile('index.js'))

const tree = parse(file, {ecmaVersion: 2022, sourceType: 'module', locations: true})

// @ts-expect-error: acorn is funky but it works fine.
console.log(toJs(tree))
```

Yields:

```js
{
  value: "export {toJs} from './lib/index.js';\nexport {jsx} from './lib/jsx.js';\n",
  map: undefined
}
```

## API

This package exports the identifiers [`jsx`](./#jsx) and [`toJs`](./#tojstree-options). There is no default export.

### `toJs(tree[, options])`

Serialize an estree as JavaScript.

**Parameters**

* `tree` ([`Program`](https://github.com/estree/estree/blob/master/es2015.md#programs)) — estree
* `options` ([`Options`](./#options)) — configuration

**Returns**

Result, optionally with source map ([`Result`](./#result)).

### `jsx`

Map of handlers to handle the nodes of JSX extensions in JavaScript ([`Handlers`](./#handlers)).

### `Handler`

Handle a particular node (TypeScript type).

**Parameters**

* `this` (`Generator`) — `astring` generator
* `node` ([`Node`](https://github.com/estree/estree/blob/master/es5.md#node-objects)) — node to serialize
* `state` ([`State`](./#state)) — info passed around

**Returns**

Nothing (`void`).

### `Handlers`

Handlers of nodes (TypeScript type).

**Type**

```ts
type Handlers = Partial<Record<Node['type'], Handler>>
```

### `Map`

Raw source map from `source-map` (TypeScript type).

### `Options`

Configuration (TypeScript type).

**Fields**

* `SourceMapGenerator` ([`SourceMapGenerator`](https://github.com/mozilla/source-map)) — generate a source map with this class
* `filePath` (`string`) — path to original input file
* `handlers` ([`Handlers`](./#handlers)) — extra handlers

### `Result`

Result (TypeScript type).

**Fields**

* `value` (`string`) — serialized JavaScript
* `map` ([`Map`](./#map) or `undefined`) — source map as (parsed) JSON

### `State`

State from `astring` (TypeScript type).

## Examples

### Example: source maps

Source maps are supported when passing the `SourceMapGenerator` class from [`source-map`](https://github.com/mozilla/source-map). You should also pass `filePath`. Modified example from § Use above:

```diff
 import fs from 'node:fs/promises'
 import {parse} from 'acorn'
+import {SourceMapGenerator} from 'source-map'
 import {toJs} from 'estree-util-to-js'

-const file = String(await fs.readFile('index.js'))
+const filePath = 'index.js'
+const file = String(await fs.readFile(filePath))

 const tree = parse(file, {
   ecmaVersion: 2022,
@@ -11,4 +13,4 @@ const tree = parse(file, {
 })

 // @ts-expect-error: acorn is funky but it works fine.
-console.log(toJs(tree))
+console.log(toJs(tree, {filePath, SourceMapGenerator}))
```

Yields:

```js
{
  value: "export {toJs} from './lib/index.js';\nexport {jsx} from './lib/jsx.js';\n",
  map: {
    version: 3,
    sources: [ 'index.js' ],
    names: [],
    mappings: 'QAOQ,WAAW;QACX,UAAU',
    file: 'index.js'
  }
}
```

### Example: comments

To get comments to work, they have to be inside the tree. This is not done by Acorn. [`estree-util-attach-comments`](https://github.com/syntax-tree/estree-util-attach-comments) can do that. Modified example from § Use above:

```diff
 import fs from 'node:fs/promises'
 import {parse} from 'acorn'
+import {attachComments} from 'estree-util-attach-comments'
 import {toJs} from 'estree-util-to-js'

 const file = String(await fs.readFile('index.js'))

+/** @type {Array<import('estree-jsx').Comment>} */
+const comments = []
 const tree = parse(file, {
   ecmaVersion: 2022,
   sourceType: 'module',
-  locations: true
+  locations: true,
+  // @ts-expect-error: acorn is funky these comments are fine.
+  onComment: comments
 })
+attachComments(tree, comments)

 // @ts-expect-error: acorn is funky but it works fine.
 console.log(toJs(tree))
```

Yields:

```js
{
  value: '/**\n' +
    "* @typedef {import('./lib/index.js').Options} Options\n" +
    "* @typedef {import('./lib/types.js').Handler} Handler\n" +
    "* @typedef {import('./lib/types.js').Handlers} Handlers\n" +
    "* @typedef {import('./lib/types.js').State} State\n" +
    '*/\n' +
    "export {toJs} from './lib/index.js';\n" +
    "export {jsx} from './lib/jsx.js';\n",
  map: undefined
}
```

### Example: JSX

To get JSX to work, handlers need to be registered. This is not done by default, but they are exported as `jsx` and can be passed. Modified example from § Use above:

```diff
 import fs from 'node:fs/promises'
-import {parse} from 'acorn'
-import {toJs} from 'estree-util-to-js'
+import {Parser} from 'acorn'
+import acornJsx from 'acorn-jsx'
+import {toJs, jsx} from 'estree-util-to-js'

-const file = String(await fs.readFile('index.js'))
+const file = '<>{1 + 1}</>'

-const tree = parse(file, {
+const tree = Parser.extend(acornJsx()).parse(file, {
   ecmaVersion: 2022,
   sourceType: 'module',
   locations: true
 })

 // @ts-expect-error: acorn is funky but it works fine.
-console.log(toJs(tree))
+console.log(toJs(tree, {handlers: jsx}))
```

Yields:

```js
{ value: '<>{1 + 1}</>;\n', map: undefined }
```

## Types

This package is fully typed with [TypeScript](https://www.typescriptlang.org). It exports the additional types [`Handler`](./#handler), [`Handlers`](./#handlers), [`Map`](./#map), [`Options`](./#options), [`Result`](./#result), and [`State`](./#state).

## Compatibility

Projects maintained by the unified collective are compatible with all maintained versions of Node.js. As of now, that is Node.js 14.14+, 16.0+, and 18.0+. Our projects sometimes work with older versions, but this is not guaranteed.

## Contribute

See [`contributing.md`](https://github.com/syntax-tree/.github/blob/main/contributing.md) in [`syntax-tree/.github`](https://github.com/syntax-tree/.github) for ways to get started. See [`support.md`](https://github.com/syntax-tree/.github/blob/main/support.md) for ways to get help.

This project has a [code of conduct](https://github.com/syntax-tree/.github/blob/main/code-of-conduct.md). By interacting with this repository, organization, or community you agree to abide by its terms.

## License

[MIT](license/) © [Titus Wormer](https://wooorm.com)
